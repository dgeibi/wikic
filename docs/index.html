<!doctype html>
<html>
  <head>
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta charset="UTF-8">
      <title>Wikic</title>
    <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/github.css">
  </head>
  <body>
    <div class="wrapper">
        <h1>Wikic</h1>
<p><a href="https://travis-ci.org/wikic/wikic"><img src="https://travis-ci.org/wikic/wikic.svg?branch=master" alt="Build Status"></a>
<a href="https://coveralls.io/github/wikic/wikic?branch=master"><img src="https://coveralls.io/repos/github/wikic/wikic/badge.svg?branch=master" alt="Coveralls"></a>
<a href="https://github.com/wikic/wikic/blob/master/LICENSE"><img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="MIT License"></a>
<a href="https://www.npmjs.com/package/wikic"><img src="https://img.shields.io/npm/v/wikic.svg" alt="version"></a>
<a href="https://nodejs.org"><img src="https://img.shields.io/badge/node-%3E%3D%208.1.3-brightgreen.svg" alt="Node"></a></p>
<p>a simple static site generator</p>
<h2 id="table-of-contents">Table of Contents<a class="anchor" href="#table-of-contents"></a></h2>
<!-- TOC -->
<ul>
<li><a href="#wikic">Wikic</a>
<ul>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#example">Example</a></li>
<li><a href="#usage">Usage</a>
<ul>
<li><a href="#cli">CLI</a>
<ul>
<li><a href="#wikic-init"><code>wikic init</code></a></li>
<li><a href="#wikic-build"><code>wikic build</code></a></li>
</ul>
</li>
<li><a href="#node-module">Node module</a></li>
</ul>
</li>
<li><a href="#getting-started">Getting started</a>
<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#configuration-and-front-matter">Configuration and Front Matter</a></li>
<li><a href="#dev-server">Dev Server</a></li>
<li><a href="#layouts">Layouts</a>
<ul>
<li><a href="#variables-in-layouts">Variables in Layouts</a></li>
<li><a href="#builtin-filters">Builtin Filters</a></li>
<li><a href="#nunjucks-in-markdown">Nunjucks in Markdown</a></li>
</ul>
</li>
<li><a href="#filter">Filter</a></li>
<li><a href="#suite">Suite</a></li>
<li><a href="#watch-handlers">Watch handlers</a></li>
</ul>
</li>
<li><a href="#thanks">Thanks</a></li>
<li><a href="#api">API</a></li>
<li><a href="#license">LICENSE</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h2 id="example">Example<a class="anchor" href="#example"></a></h2>
<ul>
<li><a href="https://github.com/dgeibi/note">dgeibi/note</a></li>
</ul>
<h2 id="usage">Usage<a class="anchor" href="#usage"></a></h2>
<h3 id="cli">CLI<a class="anchor" href="#cli"></a></h3>
<h4 id="wikic-init"><code>wikic init</code><a class="anchor" href="#wikic-init"></a></h4>
<p>Use <code>wikic init</code> to create a new wikic folder</p>
<pre class="hljs"><code>wikic init &lt;dir&gt;
</code></pre>
<h4 id="wikic-build"><code>wikic build</code><a class="anchor" href="#wikic-build"></a></h4>
<p>Use <code>wikic build</code> to build pages.</p>
<pre class="hljs"><code>wikic build [options]
<span class="hljs-comment">#  Options:</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#    -h, --help           output usage information</span>
<span class="hljs-comment">#    -c, --clean          clean public dir before building</span>
<span class="hljs-comment">#    -w, --watch          watch src dir change</span>
<span class="hljs-comment">#    -s, --serve          serve public dir</span>
<span class="hljs-comment">#    -d, --dir &lt;dir&gt;      change working dir</span>
<span class="hljs-comment">#    -o, --output &lt;dir&gt;   change public dir</span>
<span class="hljs-comment">#    -p, --port &lt;number&gt;  change server port</span>
</code></pre>
<h3 id="node-module">Node module<a class="anchor" href="#node-module"></a></h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> htmlclean = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;htmlclean&apos;</span>);
<span class="hljs-keyword">const</span> Wikic = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;wikic&apos;</span>);
<span class="hljs-keyword">const</span> docslist = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;wikic-suite-docslist&apos;</span>);

<span class="hljs-keyword">const</span> wikic = <span class="hljs-keyword">new</span> Wikic();

<span class="hljs-comment">// add filter to minify html before write</span>
wikic.filter.register(<span class="hljs-string">&apos;beforeWrite&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">minify</span>(<span class="hljs-params">context</span>) </span>{
  <span class="hljs-keyword">if</span> (!context.data) <span class="hljs-keyword">return</span> context;
  context.data = htmlclean(context.data);
  <span class="hljs-keyword">return</span> context;
});

<span class="hljs-comment">// add suite to provide `list` variable</span>
wikic.registerSuite(docslist);

<span class="hljs-comment">// build the site and start watcher and server to debug or preview</span>
wikic
  .build()
  .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> wikic.watch())
  .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> wikic.serve());
</code></pre>
<h2 id="getting-started">Getting started<a class="anchor" href="#getting-started"></a></h2>
<h3 id="installation">Installation<a class="anchor" href="#installation"></a></h3>
<pre class="hljs"><code><span class="hljs-comment"># install as a cli tool</span>
npm install -g wikic

<span class="hljs-comment"># install as a node dependency</span>
npm install --save wikic
</code></pre>
<h3 id="configuration-and-front-matter">Configuration and Front Matter<a class="anchor" href="#configuration-and-front-matter"></a></h3>
<p>Default Config: <a href="https://github.com/wikic/wikic/blob/master/lib/defaultConfig.yml">lib/defaultConfig.yml</a></p>
<p>You can create <code>_config.yml</code>s or a <code>wikic.config.js</code> to override defaultConfig.</p>
<p>Here are inheritance chains of configuration:</p>
<ul>
<li><a href="https://github.com/wikic/wikic/blob/master/lib/defaultConfig.yml">lib/defaultConfig.yml</a>, <code>_config.yml</code> and <code>wikic.config.js</code> (in <code>wikic.cwd</code>) =&gt; <code>wikic.config</code></li>
<li><code>wikic.config</code>, <code>_config.yml</code> (subdirectory of <code>wikic.cwd</code>, closest to markdown file) =&gt; <code>context.site</code></li>
<li><code>context.page</code>, <code>context.site.page</code>, Front Matter in markdown =&gt; <code>context.page</code></li>
</ul>
<p>The <code>_config.yml</code> and <code>wikic.config.js</code> in <code>wikic.cwd</code> will be loaded as <code>wikic.config</code>.</p>
<p>The <code>_config.yml</code> closest to markdown will be merged into <code>context.site</code>.</p>
<p>Front Matter in each markdown will be merged into <code>context.page</code> respectively.</p>
<p><strong>Note</strong>: In <code>wikic.cwd</code>, <code>wikic.config.js</code> &gt; <code>_config.yml</code></p>
<p><strong><code>wikic.config.js</code> Example</strong>:</p>
<pre class="hljs"><code><span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-attr">title</span>: <span class="hljs-string">&apos;Wikic&apos;</span>,
  <span class="hljs-attr">toc</span>: {
    <span class="hljs-attr">selectors</span>: <span class="hljs-string">&apos;h2, h3, h4&apos;</span>,
  },
};
</code></pre>
<p><strong>Front Matter example</strong>:</p>
<pre class="hljs"><code><span class="hljs-meta">---</span>
<span class="hljs-attr">title:</span> <span class="hljs-string">Hello</span> <span class="hljs-string">World</span> <span class="hljs-comment"># title of the page</span>
<span class="hljs-attr">toc:</span> <span class="hljs-literal">false</span> <span class="hljs-comment"># disable toc for this page</span>
<span class="hljs-attr">layout:</span> <span class="hljs-string">docs</span> <span class="hljs-comment"># set layout for this page</span>
<span class="hljs-meta">---</span>
</code></pre>
<h3 id="dev-server">Dev Server<a class="anchor" href="#dev-server"></a></h3>
<p>You should use a server extension to run <code>wikic build -s</code>.</p>
<p>Server extension Example:</p>
<ul>
<li><a href="https://www.npmjs.com/package/wikic-live-server">wikic-live-server</a></li>
</ul>
<h3 id="layouts">Layouts<a class="anchor" href="#layouts"></a></h3>
<p>You can create <a href="https://mozilla.github.io/nunjucks/templating.html">Nunjucks</a> templates (extname is <code>.njk</code>) in <code>layoutPath</code>.</p>
<p>In order to specify default layout for markdowns in a specific path, create a <code>_config.yml</code> in the path and add lines to it:</p>
<pre class="hljs"><code><span class="hljs-attr">page:</span>
<span class="hljs-attr">  layout:</span> <span class="hljs-string">customLayout</span>
</code></pre>
<p>Also, you can set <code>layout</code> in Front Matter for a specific markdown.</p>
<h4 id="variables-in-layouts">Variables in Layouts<a class="anchor" href="#variables-in-layouts"></a></h4>
<ul>
<li><code>site</code>, <code>Object</code>, reference to <code>context.site</code></li>
<li><code>page</code>, <code>Object</code>, reference to <code>context.page</code>
<ul>
<li><code>page.types</code>, <code>Array</code>, markdown&apos;s dirnames</li>
</ul>
</li>
<li><code>content</code>, string, content of HTML built from markdown</li>
</ul>
<h4 id="builtin-filters">Builtin Filters<a class="anchor" href="#builtin-filters"></a></h4>
<ul>
<li><code>typeMap</code>: Get typeName set in <code>wikic.config.typeMap</code></li>
<li><code>baseurl</code>: Get a URL prefixed with base URL</li>
<li><code>relative</code>: Receives a absolute path string, returns a url relative to current page.</li>
<li><code>typeMaps</code>: Receives a <code>Array</code>, Returns <code>array.map(typeMap)</code>.
Tips: get typeNames array <code>{{ page.types | typeMaps }}</code></li>
</ul>
<h4 id="nunjucks-in-markdown">Nunjucks in Markdown<a class="anchor" href="#nunjucks-in-markdown"></a></h4>
<p>Variable <code>site</code> and <code>page</code> is available.</p>
<p><code>{{</code>, <code>}}</code>, <code>{#</code>, <code>#}</code>, <code>{%</code>, <code>%}</code> in raw blocks and <code>&lt;code&gt;</code> blocks will be escaped.</p>
<pre class="hljs"><code><span class="hljs-comment">&lt;!-- markdown --&gt;</span>
{% raw %}
{{ page.title }}
{% endraw %}

<span class="hljs-comment">&lt;!-- output --&gt;</span>
{{ page.title }}
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">&lt;!-- markdown --&gt;</span>
`{{ page.title }}`

<span class="hljs-comment">&lt;!-- output --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>{{ page.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span>
</code></pre>
<h3 id="filter">Filter<a class="anchor" href="#filter"></a></h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> filter = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, wikic</span>) </span>{
  <span class="hljs-keyword">const</span> newContext = <span class="hljs-built_in">Object</span>.assign({}, context);
  <span class="hljs-comment">// do something with newContext</span>
  <span class="hljs-keyword">return</span> newContext;
}
</code></pre>
<p>A &apos;filter&apos; is a <code>Function</code>, which receives a <code>context</code> and the <code>wikic</code> and returns a <code>context</code>.</p>
<p>The context returned by the filter will be passed to next one.</p>
<p><strong>context</strong></p>
<p><code>context</code> of the following types of filter is <code>null</code></p>
<ul>
<li><code>afterReadAllDocs</code>: after reading all docs, before writing all docs.</li>
<li><code>beforeBuild</code>: before building all things.</li>
<li><code>beforeBuildDocs</code>: before building all docs.</li>
<li><code>afterBuild</code>: after building all things.</li>
<li><code>afterBuildDocs</code>: after building all docs.</li>
</ul>
<p><code>context</code> passed to following types of filter is an <code>Object</code></p>
<ul>
<li><code>afterRead</code>: invoked after reading each markdown file.</li>
<li><code>beforeWrite</code>: invoked before writing each markdown file.</li>
<li><code>beforeRender</code>: invoked before rendering each markdown file.</li>
</ul>
<p>The context may contains the following properties:</p>
<ul>
<li><code>src</code>: string, absolute path of source</li>
<li><code>dist</code>: string, absolute path of destination</li>
<li><code>data</code>: string, content of document</li>
<li><code>site</code>: <code>Object</code>, site config</li>
<li><code>page</code>: <code>Object</code>, page config</li>
<li><code>renderContext</code>: <code>Object</code>, nunjucks render context, contains <a href="#variables-in-layouts">variables</a></li>
<li><code>IS_DOC</code>: boolean, whether in <code>docsPath</code></li>
</ul>
<p>You can use <code>wikic.filter.register(type, filter)</code> to register filters.</p>
<h3 id="suite">Suite<a class="anchor" href="#suite"></a></h3>
<p>A suite should be a combination of filters.</p>
<p>It should be</p>
<ul>
<li>a <code>string</code> which is a module id relative to <code>wikic.cwd</code></li>
<li>a plain <code>Object</code></li>
<li>or a <code>Function</code> which receives <code>config</code> and returns an <code>Object</code> or a falsy value.</li>
</ul>
<p>Suite objects&apos; property name should be a <a href="#filter">filter</a>&apos;s type name.</p>
<p><strong>Example</strong></p>
<p>Register suites in <code>wikic.config.js</code></p>
<p>Use <code>Object</code></p>
<pre class="hljs"><code><span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-attr">suites</span>: [
    {
      <span class="hljs-attr">beforeBuild</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-built_in">console</span>.time(<span class="hljs-string">&apos;build&apos;</span>);
      },
      <span class="hljs-attr">afterBuild</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-built_in">console</span>.timeEnd(<span class="hljs-string">&apos;build&apos;</span>);
      }
    }
  ],
};
</code></pre>
<p>Use <code>Function</code></p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> showBuildTime = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">config</span>) </span>{
  <span class="hljs-comment">// if option `time` is falsy, do not add suite</span>
  <span class="hljs-keyword">if</span> (!config.time) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">beforeBuild</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-built_in">console</span>.time(<span class="hljs-string">&apos;build&apos;</span>);
    },
    <span class="hljs-attr">afterBuild</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-built_in">console</span>.timeEnd(<span class="hljs-string">&apos;build&apos;</span>);
    }
  };
}

<span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-attr">suites</span>: [showBuildTime],
};
</code></pre>
<p>Use module ID</p>
<pre class="hljs"><code><span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-attr">suites</span>: [<span class="hljs-string">&apos;wikic-suite-docslist&apos;</span>]
};
</code></pre>
<p>You can also use <code>wikic.registerSuite(suite)</code> to add suites.</p>
<h3 id="watch-handlers">Watch handlers<a class="anchor" href="#watch-handlers"></a></h3>
<p><strong>Built-in handlers</strong></p>
<p>Three built-in handlers:</p>
<ul>
<li><code>setupAndBuild</code>: Receives new config and then rebuild</li>
<li><code>build</code>: Rebuild the whole site</li>
<li><code>buildStaticFile</code>: When a static file changed which wasn&apos;t ignored by <code>config.excludes</code> or <code>config.publicExcludes</code>, build the static file (copy or generate html) and execute <code>afterBuild</code> filter</li>
</ul>
<p>You can set their values to matchers in <a href="https://www.npmjs.com/package/anymatch">anymatch</a>.</p>
<p>The default value is like following <code>wikic.config.js</code></p>
<pre class="hljs"><code><span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-attr">watchHandlers</span>: {
    <span class="hljs-attr">setupAndBuild</span>: [<span class="hljs-string">&apos;**/wikic.config.js&apos;</span>, <span class="hljs-string">&apos;**/_config.yml&apos;</span>],
    <span class="hljs-attr">build</span>: [<span class="hljs-string">`<span class="hljs-subst">${config.layoutPath}</span>/**`</span>, <span class="hljs-string">`<span class="hljs-subst">${config.docsPath}</span>/**`</span>],
    <span class="hljs-attr">buildStaticFile</span>: <span class="hljs-string">&apos;**/*&apos;</span>,
  },
}
</code></pre>
<p><strong>Custom handlers</strong></p>
<p>You can add handlers for files that won&apos;t be handled by built-in handlers like the example:</p>
<pre class="hljs"><code><span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-attr">publicExcludes</span>: [<span class="hljs-string">&apos;sw-template.js&apos;</span>],

  <span class="hljs-attr">watchHandlers</span>: {
    <span class="hljs-attr">custom</span>: {
      <span class="hljs-attr">sw</span>: {
        <span class="hljs-attr">matcher</span>: [<span class="hljs-string">&apos;sw-template.js&apos;</span>],
        <span class="hljs-attr">handler</span>: <span class="hljs-function">(<span class="hljs-params">filePath, wikic</span>) =&gt;</span> {
          <span class="hljs-keyword">try</span> {
            genSW(wikic.publicPath)
          } <span class="hljs-keyword">catch</span>(err) {
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;oops, something wrong when generating sw.js&apos;</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
            <span class="hljs-comment">// Return false to find a next matched handler</span>
          }
        },
      },
    },
  },
}
</code></pre>
<p><strong>Priority</strong></p>
<p>The order of finding handler: <code>setupAndBuild</code> &gt; <code>build</code> &gt; <code>buildStaticFile</code> &gt; <code>custom</code></p>
<h2 id="thanks">Thanks<a class="anchor" href="#thanks"></a></h2>
<ul>
<li><a href="https://github.com/hexojs/hexo">hexojs/hexo</a></li>
<li><a href="https://github.com/xcatliu/pagic">xcatliu/pagic</a></li>
<li><a href="https://github.com/jonschlinkert/html-toc">jonschlinkert/html-toc</a></li>
<li><a href="http://adrianmejia.com/blog/2016/08/24/Building-a-Node-js-static-file-server-files-over-HTTP-using-ES6/">Adrian Mejia Blog</a></li>
<li>...</li>
</ul>
<h2 id="api">API<a class="anchor" href="#api"></a></h2>
<p>See JSDoc in <a href="https://github.com/wikic/wikic/blob/master/lib/wikic/index.js">lib/wikic/index.js</a></p>
<h2 id="license">LICENSE<a class="anchor" href="#license"></a></h2>
<p><a href="https://github.com/wikic/wikic/blob/master/LICENSE">MIT</a></p>

        </div>
  </body>
</html>
